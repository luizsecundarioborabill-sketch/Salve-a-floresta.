<!DOCTYPE html>

<html lang="pt-BR">

<head>

<meta charset="UTF-8" />

<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<title>Coleta de Lixo para o Meio Ambiente - v2.0</title>

<style>

:root{

  --ui-bg:#222; --ui-txt:#fff; --btn-bg:rgba(0,0,0,.5); --green:#3a5;

}

*{box-sizing:border-box;}

body{margin:0; background:var(--ui-bg); color:var(--ui-txt); font-family:system-ui,Segoe UI,Arial,sans-serif; overflow:hidden;}

canvas{display:block;margin:0 auto;background:var(--green);border:2px solid #111}

.hud{position:absolute;top:8px;left:50%;transform:translateX(-50%);text-align:center;pointer-events:none}

.hud div{margin:3px}

#weaponBar{width:220px;height:18px;background:#555;margin:8px auto;border-radius:6px;overflow:hidden;display:none}

#weaponFill{width:0%;height:100%;background:#0f0;transition:width .15s linear}

#controls{position:absolute;bottom:10px;left:0;width:100%;text-align:center;user-select:none;-webkit-user-select:none}

#controls .row{margin:4px 0}

.control-btn{display:inline-block;font-size:22px;margin:4px;padding:14px 18px;border-radius:10px;background:var(--btn-bg);backdrop-filter:blur(2px);color:#fff;touch-action:none}

#message{position:absolute;top:45%;left:50%;transform:translate(-50%,-50%);display:none;text-align:center}

#message .title{font-size:36px;margin-bottom:8px;text-shadow:2px 2px #000}

#message .subtitle{font-size:18px;opacity:.9}

#reloadBtn{position:absolute;top:62%;left:50%;transform:translateX(-50%);padding:12px 22px;font-size:18px;background:#666;color:#fff;border:none;border-radius:10px;display:none;cursor:pointer}

#menu{position:absolute;inset:0;background:#2a7;display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:5}

#menu h1{font-size:34px;color:#fff;text-shadow:2px 2px #000;margin:0 0 16px 0;animation:float 2.2s ease-in-out infinite alternate}

#menu button{font-size:22px;padding:14px 28px;border:none;border-radius:10px;background:#444;color:#fff;cursor:pointer;animation:float 2.2s ease-in-out infinite alternate-reverse}

@keyframes float{0%{transform:translateY(0)}100%{transform:translateY(-8px)}}

#endScreen{position:absolute;inset:0;display:none;z-index:6;align-items:center;justify-content:center;background:rgba(0,0,0,.6)}

#endCard{background:#245d2b;border:2px solid #0a0;padding:24px 28px;border-radius:14px;box-shadow:0 8px 30px rgba(0,0,0,.5);text-align:center;min-width:280px}

#endCard h2{margin:0 0 8px 0;color:#caffc1;text-shadow:1px 1px #062}

#endCard p{margin:0 0 16px 0}

#endRestart{padding:10px 18px;border:none;border-radius:10px;background:#0b0;color:#fff;font-weight:700;cursor:pointer;}

</style>

</head>

<body>

<div id="menu">

  <h1>Coleta de Lixo para o Meio Ambiente</h1>

  <button id="playBtn">Play</button>

</div>

<div class="hud">

  <div id="score">Lixo: 0 / 10</div>

  <div id="lives">Vidas: 25</div>

  <div id="phase">Fase: 1 / 7</div>

  <div id="weaponBar"><div id="weaponFill"></div></div>

</div>

<div id="controls">

  <div class="row" id="row-up"><div id="upBtn" class="control-btn">â–²</div></div>

  <div class="row" id="row-leftdownright">

    <div id="leftBtn" class="control-btn">âŸµ</div>

    <div id="downBtn" class="control-btn">â–¼</div>

    <div id="rightBtn" class="control-btn">âŸ¶</div>

  </div>

</div>

<div id="message">

  <div class="title" id="messageTitle"></div>

  <div class="subtitle" id="messageSub"></div>

</div>

<button id="reloadBtn">Reiniciar</button>

<div id="endScreen">

  <div id="endCard">

    <h2>ðŸŽ‰ ParabÃ©ns! Fim de jogo!</h2>

    <p>VocÃª derrotou o Boss e salvou a floresta ðŸŒ³</p>

    <button id="endRestart">Reiniciar</button>

  </div>

</div>

<canvas id="gameCanvas" width="400" height="600"></canvas>

<script>

(() => {

const canvas=document.getElementById('gameCanvas');

const ctx=canvas.getContext('2d');

const WIDTH=canvas.width, HEIGHT=canvas.height;

const player={x:50,y:50,w:26,h:26,speed:3,blink:0};

const game={score:0,lives:25,phase:1,isGameOver:false,weaponLoaded:false,victory:false};

let boss=null, BOSS_MAX_HP=20;

let enemies=[], trash=[], enemyBullets=[], playerBullets=[], trees=[], explosionParticles=[], victoryPending=false;

let move={up:false,down:false,left:false,right:false};

let playerShootTimer=0;

const clamp=(v,min,max)=>Math.max(min,Math.min(max,v));

const rectsCollide=(a,b)=>a.x < b.x + b.w && a.x + a.w > b.x && a.y < b.y + b.h && a.y + a.h > b.y;

const rand=(a,b)=>a+Math.random()*(b-a);

function drawTree(x,y){

  ctx.fillStyle='#6a4'; ctx.fillRect(x+8,y+18,4,18);

  ctx.fillStyle='#083'; ctx.fillRect(x,y,20,18); ctx.fillRect(x+4,y-8,12,10);

}

function generateTrees(count){trees=[]; let tries=0; while(trees.length<count && tries<5000){tries++; const x=10+Math.random()*(WIDTH-30); const y=70+Math.random()*(HEIGHT-120); const t={x,y,w:20,h:26};

const overlapEnemy=enemies.some(e=>rectsCollide(t,e)); const overlapBoss=boss?rectsCollide(t,boss):false;

const nearOtherTree=trees.some(o=>!(t.x+t.w<o.x-8||t.x>o.x+o.w+8||t.y+t.h<o.y-8||t.y>o.y+o.h+8));

if(overlapEnemy||overlapBoss||nearOtherTree) continue; trees.push(t);}

}

function generateEnemies(phase){enemies=[]; boss=null;

if(phase<7){

  let count=(phase>=3 && phase<=6)?4: (phase<3?2:2);

  for(let i=0;i<count;i++){

    enemies.push({x:50+Math.random()*(WIDTH-100),y:100+Math.random()*(HEIGHT-200),w:28,h:28,shootTimer:Math.random()*60,eyeBlink:0});

  }

}else{boss={x:150,y:90,w:100,h:100,shootTimer:0,hp:BOSS_MAX_HP,eyeBlink:0};}

}

function generateTrash(phase){

  const items=[]; const target=(phase===7)?20:10; let tries=0;

  while(items.length<target && tries<6000){tries++;

    const w=18,h=18; const x=12+Math.random()*(WIDTH-24-w); const y=64+Math.random()*(HEIGHT-128-h); const c={x,y,w,h};

    const overlapEnemy=enemies.some(e=>rectsCollide(c,e)); const overlapBoss=boss?rectsCollide(c,boss):false;

    if(overlapEnemy||overlapBoss) continue;

    const pad=20; const nearPlayer=!(c.x+c.w<player.x-pad||c.x>player.x+player.w+pad||c.y+c.h<player.y-pad||c.y>player.y+player.h+pad);

    if(nearPlayer) continue; items.push(c);

  }

  return items;

}

function startPhase(newPhase){

  game.phase=newPhase; game.score=0; game.weaponLoaded=false; game.isGameOver=false; game.victory=false;

  enemyBullets.length=0; playerBullets.length=0; explosionParticles.length=0; victoryPending=false;

  hideMessage(); hideReload(); hideEndScreen();

  generateEnemies(game.phase); trash=generateTrash(game.phase); generateTrees(18);

  const bar=document.getElementById('weaponBar'); const fill=document.getElementById('weaponFill');

  if(game.phase===7){bar.style.display='block'; fill.style.width='0%'; document.getElementById('score').innerText='Lixo: 0 / 20';}

  else{bar.style.display='none'; document.getElementById('score').innerText='Lixo: 0 / 10';}

  updateHUD();

}// ====== DRAW ======

function draw(){

  ctx.fillStyle='#3a5'; ctx.fillRect(0,0,WIDTH,HEIGHT);

  for(const t of trees) drawTree(t.x,t.y);

  // Player

  if(player.blink%10<5){

    ctx.fillStyle='#f68000'; ctx.fillRect(player.x,player.y,player.w,player.h);

    ctx.fillStyle='#ffcc88'; ctx.fillRect(player.x+6,player.y-8,14,8);

    ctx.fillStyle='#5a3'; ctx.fillRect(player.x+4,player.y-12,18,4);

    ctx.fillStyle='#000'; ctx.fillRect(player.x+9,player.y-5,2,2); ctx.fillRect(player.x+15,player.y-5,2,2);

    ctx.fillStyle='#d86e00'; ctx.fillRect(player.x-3,player.y+8,3,8); ctx.fillRect(player.x+player.w,player.y+8,3,8);

    ctx.fillRect(player.x+5,player.y+player.h,4,6); ctx.fillRect(player.x+17,player.y+player.h,4,6);

  }

  // Trash

  for(const t of trash){ctx.fillStyle='#ffd54a'; ctx.fillRect(t.x,t.y,t.w,t.h); ctx.fillStyle='#ffb300'; ctx.fillRect(t.x+5,t.y+5,4,4);}

  // Enemies

  for(const e of enemies){

    ctx.fillStyle='#0a3'; ctx.fillRect(e.x,e.y,e.w,e.h);

    const blinkOpen=(Math.floor(e.eyeBlink/120)%2===0);

    ctx.fillStyle=blinkOpen?'#fff':'#0a3';

    ctx.fillRect(e.x+6,e.y+6,5,5); ctx.fillRect(e.x+e.w-11,e.y+6,5,5);

    if(blinkOpen){ctx.fillStyle='#000'; ctx.fillRect(e.x+7,e.y+7,3,3); ctx.fillRect(e.x+e.w-10,e.y+7,3,3);}

  }

  // Boss

  if(boss){

    ctx.fillStyle='#0a3'; ctx.fillRect(boss.x,boss.y,boss.w,boss.h);

    const blinkOpen=(Math.floor(boss.eyeBlink/120)%2===0);

    ctx.fillStyle=blinkOpen?'#fff':'#0a3';

    ctx.fillRect(boss.x+22,boss.y+22,14,14); ctx.fillRect(boss.x+boss.w-36,boss.y+22,14,14);

    if(blinkOpen){ctx.fillStyle='#000'; ctx.fillRect(boss.x+26,boss.y+26,6,6); ctx.fillRect(boss.x+boss.w-32,boss.y+26,6,6);}

    ctx.fillStyle='#111'; ctx.fillRect(boss.x,boss.y-12,boss.w,6);

    ctx.fillStyle='#0f0'; ctx.fillRect(boss.x,boss.y-12,boss.w*(boss.hp/BOSS_MAX_HP),6);

  }

  ctx.fillStyle='lime'; for(const b of enemyBullets) ctx.fillRect(b.x,b.y,b.w,b.h);

  ctx.fillStyle='#0ff'; for(const p of playerBullets) ctx.fillRect(p.x,p.y,p.w,p.h);

  for(const part of explosionParticles){ctx.globalAlpha=Math.max(part.life/part.maxLife,0); ctx.fillStyle='#2eff7e'; ctx.fillRect(part.x,part.y,part.size,part.size); ctx.globalAlpha=1;}

}

// ====== UPDATE ======

function update(){

  if(game.isGameOver || game.victory) return;

  player.x+=(move.right?player.speed:0)-(move.left?player.speed:0);

  player.y+=(move.down?player.speed:0)-(move.up?player.speed:0);

  player.x=clamp(player.x,0,WIDTH-player.w); player.y=clamp(player.y,0,HEIGHT-player.h);

  if(player.blink>0) player.blink--;

  // Coleta lixo

  for(let i=trash.length-1;i>=0;i--){

    if(rectsCollide(player,trash[i])){

      const t=trash[i]; for(let k=0;k<6;k++){explosionParticles.push({x:t.x+rand(0,t.w),y:t.y+rand(0,t.h),vx:rand(-1,1),vy:rand(-1.2,-0.2),size:3,life:16,maxLife:16});}

      trash.splice(i,1); game.score++;

      if(game.phase===7){

        const perc=Math.min((game.score/20)*100,100); document.getElementById('weaponFill').style.width=perc+'%';

        if(game.score>=20) game.weaponLoaded=true;

        document.getElementById('score').innerText=`Lixo: ${game.score} / 20`;

      }else{document.getElementById('score').innerText=`Lixo: ${game.score} / 10`;}

    }

  }

  if(game.phase<7 && game.score>=10){startPhase(game.phase+1);}

  // Inimigos

  for(const e of enemies){

    e.eyeBlink++; e.shootTimer++;

    if(e.shootTimer>90){const sx=e.x+e.w/2,sy=e.y+e.h/2; const dx=(player.x+player.w/2)-sx, dy=(player.y+player.h/2)-sy;

      const mag=Math.hypot(dx,dy)||1, speed=2;

      enemyBullets.push({x:sx-4,y:sy-4,w:8,h:8,vx:dx/mag*speed,vy:dy/mag*speed,fromBoss:false}); e.shootTimer=0;}

  }

  // Boss

  if(boss){

    boss.eyeBlink++; boss.shootTimer++;

    if(boss.shootTimer>18){const sx=boss.x+boss.w/2,sy=boss.y+boss.h/2; const dx=(player.x+player.w/2)-sx, dy=(player.y+player.h/2)-sy;

      const mag=Math.hypot(dx,dy)||1, speed=4.6; enemyBullets.push({x:sx-5,y:sy-5,w:10,h:10,vx:dx/mag*speed,vy:dy/mag*speed,fromBoss:true}); boss.shootTimer=0;}

    if(game.weaponLoaded){playerShootTimer++; if(playerShootTimer>=20){playerShootTimer=0;

      const px=player.x+player.w/2,py=player.y+player.h/2;

      const dx=(boss.x+boss.w/2)-px,dy=(boss.y+boss.h/2)-py; const mag=Math.hypot(dx,dy)||1; const speed=1.7;

      playerBullets.push({x:px-3,y:py-3,w:6,h:6,vx:dx/mag*speed,vy:dy/mag*speed});}}

  }

  // Atualizar projÃ©teis inimigos

  for(let i=enemyBullets.length-1;i>=0;i--){

    const b=enemyBullets[i]; b.x+=b.vx; b.y+=b.vy;

    if(rectsCollide(b,player)){enemyBullets.splice(i,1); game.lives-=1; player.blink=18; updateHUD(); if(game.lives<=0) gameOver(); continue;}

    if(b.x<-16||b.x>WIDTH+16||b.y<-16||b.y>HEIGHT+16) enemyBullets.splice(i,1);

  }

  // ProjÃ©teis player

  for(let i=playerBullets.length-1;i>=0;i--){

    const p=playerBullets[i]; p.x+=p.vx; p.y+=p.vy;

    if(boss && rectsCollide(p,boss)){playerBullets.splice(i,1); boss.hp-=1; if(boss.hp<=0) doBossExplosion(); continue;}

    if(p.x<-20||p.x>WIDTH+20||p.y<-20||p.y>HEIGHT+20) playerBullets.splice(i,1);

  }

  // PartÃ­culas

  for(let i=explosionParticles.length-1;i>=0;i--){const part=explosionParticles[i]; part.x+=part.vx; part.y+=part.vy; part.vy+=0.04; part.life--; if(part.life<=0) explosionParticles.splice(i,1);}

  if(victoryPending && explosionParticles.length===0){showEndScreen(); game.victory=true;}

}

// ====== FunÃ§Ãµes Boss ======

function doBossExplosion(){if(!boss) return; const cx=boss.x+boss.w/2,cy=boss.y+boss.h/2; for(let i=0;i<120;i++){explosionParticles.push({x:cx+rand(-6,6),y:cy+rand(-6,6),vx:rand(-2.2,2.2),vy:rand(-2.6,0.6),size:2+Math.random()*3,life:26+Math.random()*14,maxLife:40});} boss=null; victoryPending=true;}

// ====== HUD / UI ======

function updateHUD(){document.getElementById('lives').innerText=`Vidas: ${game.lives}`; document.getElementById('phase').innerText=`Fase: ${game.phase} / 7`;}

function showMessage(title,sub){const m=document.getElementById('message'); document.getElementById('messageTitle').innerText=title; document.getElementById('messageSub').innerText=sub||''; m.style.display='block';}

function hideMessage(){document.getElementById('message').style.display='none';}

function showReload(){document.getElementById('reloadBtn').style.display='block';}

function hideReload(){document.getElementById('reloadBtn').style.display='none';}

function showEndScreen(){document.getElementById('endScreen').style.display='flex';}

function hideEndScreen(){document.getElementById('endScreen').style.display='none';}

function gameOver(){game.isGameOver=true; showMessage('Game Over!','Tente novamente.'); showReload();}

// ====== Controles Touch ======

function bindTouchHold(id,dir){const el=document.getElementById(id); const onStart=ev=>{ev.preventDefault(); move[dir]=true;}; const onEnd=ev=>{ev.preventDefault(); move[dir]=false;};

el.addEventListener('touchstart',onStart,{passive:false}); el.addEventListener('touchend',onEnd,{passive:false}); el.addEventListener('touchcancel',onEnd,{passive:false});

el.addEventListener('mousedown',onStart); window.addEventListener('mouseup',onEnd); el.addEventListener('dragstart',e=>e.preventDefault());}

['upBtn','downBtn','leftBtn','rightBtn'].forEach(id=>{const dir=id.replace('Btn','').toLowerCase(); bindTouchHold(id,dir);});

// Teclado opcional

window.addEventListener('keydown',(e)=>{if(e.code==='ArrowUp'||e.code==='KeyW') move.up=true; if(e.code==='ArrowDown'||e.code==='KeyS') move.down=true; if(e.code==='ArrowLeft'||e.code==='KeyA') move.left=true; if(e.code==='ArrowRight'||e.code==='KeyD') move.right=true;});

window.addEventListener('keyup',(e)=>{if(e.code==='ArrowUp'||e.code==='KeyW') move.up=false; if(e.code==='ArrowDown'||e.code==='KeyS') move.down=false; if(e.code==='ArrowLeft'||e.code==='KeyA') move.left=false; if(e.code==='ArrowRight'||e.code==='KeyD') move.right=false;});

// BotÃµes UI

document.getElementById('playBtn').addEventListener('click',()=>{document.getElementById('menu').style.display='none'; startPhase(1);});

document.getElementById('reloadBtn').addEventListener('click',()=>{player.x=50;player.y=50;player.blink=0;game.score=0;game.lives=25;game.phase=1;game.isGameOver=false;game.weaponLoaded=false;game.victory=false; enemyBullets.length=0; playerBullets.length=0; explosionParticles.length=0; victoryPending=false; document.getElementById('weaponBar').style.display='none'; document.getElementById('weaponFill').style.width='0%'; hideMessage(); hideReload(); hideEndScreen(); generateEnemies(1); trash=generateTrash(1); generateTrees(18); updateHUD();});

document.getElementById('endRestart').addEventListener('click',()=>{player.x=50;player.y=50;player.blink=0;game.score=0;game.lives=25;game.phase=1;game.isGameOver=false;game.weaponLoaded=false;game.victory=false; enemyBullets.length=0; playerBullets.length=0; explosionParticles.length=0; victoryPending=false; document.getElementById('weaponBar').style.display='none'; document.getElementById('weaponFill').style.width='0%'; hideEndScreen(); generateEnemies(1); trash=generateTrash(1); generateTrees(18); updateHUD();});

// Loop

function loop(){update(); draw(); requestAnimationFrame(loop);}

loop();

})();

</script